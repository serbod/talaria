#summary DNMP - формат сообщений

= Distributed Network Messaging Protocol =

Коммерческое использование только с разрешения автора.<br>
При использовании необходимо явно указывать ссылку на источник.

<p>Sergey Bodrov, 2008-12-26</p>

= Формат сообщений =

<p align="center"><img src="https://talaria.googlecode.com/svn/trunk/docs/html/pics/dnmp_msg.png" /></p>

<code>
Описание имеет вид:
число_байт - описание
ХХ - переменное число байт

04 - размер сообщения
04 - тип сообщения
04 - таймштамп
08 - адрес отправителя
08 - адрес получателя
04 - смещение от конца до синбаев (размер синбаев)
04 - размер служебной информации
XX - служебная информация
04 - размер содержимого сообщения
XX - содержимое сообщения
XX - синбаи (по 4 байта)
</code>

<p>Размер указывает число байтов, следующих за самим размером. Например, размер сообщения 80 байт, это значит, что сначала идет значение размера (4 байта), а потом само сообщение (80 байт).</p>

Служебная информация представляет собой набор текстовых строк, разделенных символами перевода строки (CR+LF). Формат данных в строках определяется типом сообщения. Общие правила:
<li> Первое слово в строке является ключевым. 
<li> После ключевого слова может следовать разделитель и параметры (один или несколько).
<li> Если в начале строки стоит пробел или таб, то это продолжение предыдущей строки.
<li> Пустая строка (состоящая только из символов перевода строки) означает конец служебной информации.

Разделителем может быть знак "=" (равно), ":" (двоеточие) или " " (пробел), в зависимости от формата данных. Варианты форматов данных:
<li> имя значение1 значение2
<li> имя=значение
<li> имя: имя1=значение1; имя2=значение2


Номер узла и номер точки в адресе, а также размеры блоков представлены в виде векторов по 32 бита (4 байта). Если первый бит 32-битного вектора равен 1, то к значению вектора прибавляется еще один вектор на 32 бита.<br>
<code>
Вектор 32 бит:  0xxx xxxx
Вектор 64 бит:  1xxx xxxx  0xxx xxxx
Вектор 96 бит:  1xxx xxxx  1xxx xxxx  0xxx xxxx
</code>

= Типы сообщений =

<li><a href="https://code.google.com/p/talaria/wiki/auth">AUTH (Authentication) - Аутентификация</a>
<li><a href="https://code.google.com/p/talaria/wiki/info">INFO (Information) - Обмен служебной информацией</a>
<li><a href="https://code.google.com/p/talaria/wiki/usrd">USRD (Users Directory) - Каталог пользователей</a>
<li><a href="https://code.google.com/p/talaria/wiki/srvd">SRVD (Services Directory) - Каталог сервисов</a>
<li><a href="https://code.google.com/p/talaria/wiki/grpc">GRPC (Group Chat) - Канал, групповой чат</a>
<li><a href="https://code.google.com/p/talaria/wiki/flst">FLST (Files Storage) - Хранилище файлов</a>
<li><a href="https://code.google.com/p/talaria/wiki/chat">CHAT (Short messages) - Чат, короткие сообщения между пользователями</a>
<li><a href="https://code.google.com/p/talaria/wiki/mail">MAIL (Long messages) - Почта, длинные сообщения между пользователями</a>
<li><a href="https://code.google.com/p/talaria/wiki/foru">FORU (Forums) - Форумы</a>