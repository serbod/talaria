#summary Обмен короткими сообщениями (чат)

<h1>Distributed Network Messaging Protocol</h1>

Коммерческое использование только с разрешения автора.<br>
При использовании необходимо явно указывать ссылку на источник.

<p>Sergey Bodrov, 2014-07-21</p>

<h1>Сервис CHAT</h1>

<p>Сервис CHAT предназначен для обмен короткими (до 1Кбайт) сообщениями между пользователями. Сообщения могут быть как текстовыми, так и мультимедийными (звук, видео). Также возможна оргранизация независимого сеанса связи между абонентами, при этом сообщения CHAT играют роль "служебного" канала связи.</p>

Сообщение содержит:<br>
<li>дату-время создания
<li>имя автора
<li>GUID автора
<li>имя получателя
<li>GUID получателя
<li>формат сообщения
<li>текст сообщения

<h2>Формат сообщений DNMP</h2>

<u>Обязательные реквизиты для всех сообщений</u><br>
Тип: <b>CHAT</b><br>
<b>Параметры:</b><br>
<b>timestamp</b> - таймштамп сообщения<br>
<b>author_name</b> - имя автора сообщения<br>
<b>author_guid</b> - GUID автора сообщения<br>
<b>target_name</b> - имя получателя сообщения<br>
<b>target_guid</b> - GUID получателя сообщения<br>
<b>cmd</b> - команда<br>

<h2>Команды:</h2>

<h3>MSG</h3>
Отправка короткого текстового сообщения.<br>
(сервер, клиент) Если абонент в "черном списке", то возвращаем отказ.<br>
<br>
<b>Параметры:</b><br>
cmd=MSG<br>
req - требуется отчет о доставке
<br>
Данные:<br>
Текст сообщения<br>


<h3>FILE</h3>
Отправка информации о файле для передачи. Если файл небольшой (до 16 Кбайт), то он передается целиком в поле данных. Если файл большой, то в поле данных передается предварительный просмотр для файла:
  * для изображений - уменьшенное изображение
  * для архивов - список файлов в архиве
  * для аудио - информация о файле
  * для видео - информация о файле
  * для исполнимых файлов - иконка
(сервер, клиент) Если абонент в "черном списке", то возвращаем отказ.<br>
<b>Параметры:</b><br>
  * cmd=FILE<br>
  * req - (optional) требуется отчет о доставке
  * file_name - название файла
  * file_size - размер файла (в байтах)
  * file_date - дата создания файла (ISO 8601)
  * preview - (optional) данные содержат предпросмотр для большого файла
  * file_info - (optional) описание содержимого файла
  * file_params - (optional) параметры файла
  * offset - (optional, default=0) смещение данных от начала файла, в байтах
Данные:<br>
содержимое файла<br>

<h3>FREQ</h3>
Запрос файла.<br>
(сервер, клиент) Если абонент в "черном списке", то возвращаем отказ.<br>
<b>Параметры:</b><br>
  * cmd=FREQ
  * req - (optional) требуется отчет о доставке
  * file_name - file name
  * preview - (optional) request only preview for large file
  * offset - (optional, default=0) offset from beginning of file, bytes
  * size - (optional) size of requested data
Данные:<br>
Текст сообщения<br>


<h3>INVITE</h3><br>
Вызов абонента, приглашение начать беседу. В ответ вызываемый абонент присылает согласие (ACK) или отказ (BYE). В параметрах может быть указан формат беседы - голосовая, видео, итд.. По умолчанию текстовый формат.<br>
(сервер, клиент) Если абонент в "черном списке", то возвращаем отказ.<br>
<br>
<b>Параметры:</b><br>
cmd=INVITE<br>
<br>
Данные:<br>
Текст сообщения приглашения<br>


<h3>ACK</h3><br>
Прием вызова абонента, начало беседы. В параметрах может быть указан формат беседы - голосовая, видео, итд.. По умолчанию текстовый формат.<br>
<br>
<b>Параметры:</b><br>
cmd=ACK<br>
<br>
Данные:<br>
Текст сообщения приветствия<br>


<h3>BYE</h3><br>
Отказ вызова абонента, завершение беседы.<br>
<br>
<b>Параметры:</b><br>
cmd=BYE<br>
<br>
Данные:<br>
Текст описания отказа<br>