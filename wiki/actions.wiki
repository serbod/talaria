#summary DNMP - описание основных действий

<h2>Distributed Network Messaging Protocol</h2>

Коммерческое использование только с разрешения автора.<br>
При использовании необходимо явно указывать ссылку на источник.

<p>Sergey Bodrov, 2015-01-20</p>

<h1>DNMP - описание основных действий</h1>

<h2>Подключение, авторизация</h2>

Хозяин -> Гость
Контактные данные хозяина, тестовая фраза (строка случайных символов)

Гость -> Хозяин
Контактные данные гостя и тестовая фраза, шифрованная ключом
 Если ключа нет, то ключом становится тестовая фраза

Хозяин -> Гость
результат опознания
 Если гость известен, расшифровываем ключом ответ гостя, сравниваем с отправленной ранее тестовой фразой
 Если ключа нет, то ключом становится тестовая фраза
 Если гость неизвестен, то он добавляется в список контактов, требующих подтверждения


<h2>После успешной авторизации</h2>

<h3>Обновление статуса контакта</h3>

Гость
Меняет статус - online или busy

Хозяин -> Гость
Запрос детальных сведений о контакте INFO GINF

Гость -> Хозяин
Детальные сведения о контакте INFO CINF
Полученый Статус должен быть не offline

Хозяин
Рассылает линкам (кроме Гостя) уведомления о новом статусе Гостя INFO UPDI
{{{ Нужна оптимизация, чтобы не спамить уведомлениями. Накапливать уведомления и рассылать пакетами. Рассылать только подписчикам Гостя. }}}

<h3>Передача отложенных сообщений</h3>

{{{ Как бы это лучше сделать? По запросу клиента с возможностью выбора (как в почтовых сервисах) или автоматом с возможностью отмены (как в чатах) }}}

Хозяин -> Гость
Отложенные сообщения (если есть)

Гость -> Хозяин
Гость может отменить прием отложенных сообщений INFO CLIN

<h3>Обновление нодлиста</h3>

{{{ Не всегда есть необходимость каждый раз обновлять нодлист. Только если он меньше NN узлов или не обновлялся NN дней. }}}

Гость -> Хозяин
Запрос нодлиста INFO NLRQ

Хозяин -> Гость
Нодлист INFO NLST
{{{ Нодлист может быть очень большим. Может поинтам выдавать только часть нодлиста? }}}

<h3>Обновление сервисов</h3>

Гость -> Хозяин
Запрос списка сервисов SRVD GET_TYPES

Гость -> Хозяин
Запрос обновлений по подписанным сервисам